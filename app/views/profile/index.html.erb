<% content_for(:header_title){ _("Your profile") } %>

<%= simple_form_for :update, :url => profile_update_path, :html => {:onsubmit => "return on_profile_save();"} do |f| %>
<%= Knj::Web.hiddens([["passwd_md5", nil]]).html_safe %>

<%=DesignBox.boxt(_("Enter details"), 350)%>
  <table class="form">
    <%= Knj::Web.inputs([{
      :title => _("Email"),
      :name => "texemail",
      :descr => _("The email that you want notifications and stuff sent to."),
      :value => current_user.email
    },{
      :title => _("Password"),
      :name => "texpasswd",
      :type => :password,
      :descr => _("You can enter a new password to change it.")
    }]).html_safe %>
    <tr>
      <td colspan="2" class="buttons">
        <input type="submit" value="<%=_"Save"%>" />
      </td>
    </tr>
  </table>
<%=DesignBox.boxb%>

<% end %>

<script>
  $(document).ready(function(){
    $("#texpasswd").val("")
    $("#texpasswd").focus()
  })
  
  function on_profile_save(){
    $("input[name=passwd_md5]").val($.md5($("#texpasswd").val()))
    $("#texpasswd").val("")
    return true
  }
</script>

<br />

<%=DesignBox.boxt(_("Task-list"), 350)%>
  <table class="list">
    <thead>
      <tr>
        <th><%=_"Task"%></th>
      </tr>
    </thead>
    <tbody>
      <%
        count = 0
        
        current_user.tasks.order(:name).find_each do |task|
          next unless can? :show, task
          count += 1
          
          %>
            <tr>
              <td>
                <%= link_to_task task %>
              </td>
            </tr>
          <%
        end
        
        if count <= 0
          %>
            <tr>
              <td colspan="1" class="error">
                <%=_"No tasks has been added to your list."%>
              </td>
            </tr>
          <%
        end
      %>
    </tbody>
  </table>
<%=DesignBox.boxb%>
