<% content_for(:header_title){ _("Search for customers") } %>

<form method="get">
<%= Knj::Web.hiddens([{:name => :choice, :value => :dosearch}]).html_safe %>

<%=DesignBox.boxt(_("Enter criteria"), "350px")%>
  <table class="form">
    <%= Knj::Web.inputs([{
      :title => _("Name"),
      :name => :texname,
      :value => params["texname"],
      :descr => _("A part of the customers name which you are looking for.")
    }]).html_safe %>
    <tr>
      <td colspan="2" class="buttons">
        <input type="button" value="<%=_("Add new customer")%>" onclick="location.href='<%= new_customer_path %>';" />
        <input type="submit" value="<%=_("Search")%>" />
      </td>
    </tr>
  </table>
<%=DesignBox.boxb%>

</form>

<script type="text/javascript">
  $("#texname").focus();
</script>

<%
  if params["choice"] == "dosearch"
    args = {}
    
    if params["texname"].to_s.length > 0
      args["name_cont"] = params["texname"]
    end
    
    customers = Customer.ransack(args).result.order(:name)
    
    %>
      <br />
      
      <%=DesignBox.boxt(_("Results"), "350px")%>
        <table class="list">
          <thead>
            <tr>
              <th><%=_("Customer")%></th>
            </tr>
          </thead>
          <tbody>
            <% customers.each do |customer| %>
              <tr>
                <td>
                  <%= link_to_customer customer %>
                </td>
              </tr>
            <% end %>
            <% if customers.none? %>
              <tr>
                <td colspan="1" class="error">
                  <%=_("No customers were found.")%>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      <%=DesignBox.boxb%>
    <%
  end
%>