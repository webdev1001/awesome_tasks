<%
  if !can?(:admin, :admin)
    flash[:warning] = (_("You are not an administrator and cannot view this page."))
    redirect_to :back
  end
  
  if @project.deadline_at
    date_deadline_str = l(project.deadline_at, :format => :long)
  end
%>

<%= simple_form_for @project do |f| %>

<%=DesignBox.boxt(_("Enter details"), "500px")%>
  <table class="form">
    <%= Knj::Web.inputs([{
      :title => _("Name"),
      :name => "project[name]",
      :value => [@project, :name],
      :descr => _("The name of the project as it should appear in this system.")
    },{
      :title => _("Deadline"),
      :name => "project[deadline_at]",
      :value => date_deadline_str,
      :descr => _("The deadline of the project.")
    },{
      :title => _("Price per hour"),
      :name => "project[price_per_hour]",
      :value => [@project, :price_per_hour]
    },{
      :title => _("Price per hour transport"),
      :name => "project[price_per_hour_transport]",
      :value => [@project, :price_per_hour_transport]
    },{
      :title => _("Customer"),
      :name => "project[customer_id]",
      :value => [@project, :customer_id],
      :descr => _("The customer that this project belongs under."),
      :opts => Customer.all
    }]).html_safe %>
    
    <% unless @project.new_record? %>
      <%= Knj::Web.inputs([{
        :title => _("Added by"),
        :type => :info,
        :value => link_to_user(@project.added_user),
        :descr => _("The user that added this project.")
      }]).html_safe %>
    <% end %>
      
    <%= Knj::Web.inputs([{
      :title => _("Description"),
      :name => "project[description]",
      :value => [@project, :description],
      :height => 400,
      :descr => _("A description of the project to tell what it is about.")
    }]).html_safe %>
    <tr>
      <td colspan="2" class="buttons">
        <%if !@project.new_record?%>
          <input type="button" value="<%=_("Show")%>" onclick="location.href='<%= project_path(@project) %>';" />
          <input type="button" value="<%=_("Add task")%>" onclick="location.href='<%= new_task_path(:task => {:project_id => @project.id}) %>';" />
          <%= link_to _("Delete"), project_path(@project), :method => :delete, :class => "button", :data => {:confirm => _("Do you want to delete this project?")} %>
        <%end%>
        <input type="submit" value="<%=_("Save")%>" />
      </td>
    </tr>
  </table>
<%=DesignBox.boxb%>

<% end %>

<script type="text/javascript">
  $("#texname").focus();
</script>