- content_for(:header_title){ sprintf(_("Show project: %s."), @project.name) }

%table.project_table{data: {project_id: @project.id, assigned_users_path: assigned_users_project_path(@project)}}
  %tr
    %td{style: "vertical-align: top;"}
      = design_box _("Actions"), 350 do
        = link_to _("Edit project"), edit_project_path(@project), class: "button" if can?(:admin, :admin)
        = link_to _("Add task"), new_task_path(task: {project_id: @project.id}), class: "button"

      %br

      = design_box _("Information"), 350 do
        %table.form
          %tbody
            %tr
              %td.tdt= Project.human_attribute_name(:organization)
              %td= link_to_organization @project.organization
            %tr
              %td.tdt= Project.human_attribute_name(:state)
              %td= @project.translated_state
            %tr
              %td.tdt= _("Added by")
              %td= link_to_user(@project.user_added)
            %tr
              %td.tdt= Project.human_attribute_name(:created_at)
              %td= (@project.created_at ? l(@project.created_at, format: :long) : "")
            %tr
              %td.tdt= Project.human_attribute_name(:price_per_hour)
              %td= format_number @project.price_per_hour
            %tr
              %td.tdt= Project.human_attribute_name(:price_per_hour_transport)
              %td= format_number @project.price_per_hour_transport
            - if @project.deadline_at
              %tr
                %td.tdt= _("Deadline")
                %td= l(@project.deadline_at.to_date)
    %td{style: "vertical-align: top; padding-left: 15px;"}
      = design_box User.model_name.human(count: 2), 350 do
        %div{style: "padding-bottom: 15px;"}
          = link_to _("Assign user"), "#", class: ["button", "assign-user-button"], data: {title: _("Assign user"), url: search_users_path(ajaxsearch: true, jscallback: :project_show_assign_user_choose, not_in_project_id: @project.id)}
        #divassignedusers
          = render "assigned_users", project: @project

      %br

      = design_box _("Autoassigned users"), 350 do
        %div{style: "padding-bottom: 15px;"}
          = link_to _("Add autoassigned user"), new_project_project_autoassigned_user_path(@project), class: "button"
        = render "autoassigned_users", project: @project

%br

= design_box Task.model_name.human(count: 2) do
  %table.list.tasks-list
    %thead
      %tr
        %th= sort_link @ransack, :name, Task.model_name.human
        %th= _("Progress")
        %th= sort_link @ransack, :user_name, _("Author")
        %th= sort_link @ransack, :state
        %th= sort_link @ransack, :created_at, _("Date")
    %tbody
      - count = 0
      - @tasks.each do |task|
        - next unless can?(:show, task)
        - count += 1
        %tr
          %td= link_to_task task
          %td= render "/tasks/progress", task: task
          %td= link_to_user task.user
          %td= task.translated_state
          %td= l(task.created_at.to_date) if task.created_at
      - if count <= 0
        %tr
          %td.error{colspan: 2}
            = _("No tasks were found.")

%br
= will_paginate @tasks
