<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"> 
<html>
<head>
  <title><%= yield(:header_title) %></title>
  
  <%= stylesheet_link_tag    "application", media: "all" %>
  <%= javascript_include_tag "application" %>
  <%= csrf_meta_tags %>
</head>
<body>
  <script type="text/javascript">
    var js_settings = {
      "knjjs_url": "<%=@knjjsfw_url%>"
    }
    
    var locale_strings = {
      "close": "<%=_('Close')%>",
      "comment_edit_title": "<%=_('Edit comment')%>",
      "timelog_edit_title": "<%=_('Edit timelog')%>",
      "task_check_edit_title": "<%=_('Edit task-check')%>"
    }
  </script>
  
  <center>
  <table class="main_table" cellspacing="0" cellpadding="0">
    <tr>
      <td colspan="3" class="main_logo">
        knjTasks
      </td>
    </tr>
    <tr>
      <td class="main_corner_top_left"></td>
      <td class="main_side_top"></td>
      <td class="main_corner_top_right"></td>
    </tr>
    <tr>
      <td class="main_side_left"></td>
      <td class="main_body">
        <div class="main_menu_outer">
          <div class="main_menu_inner">
          <%
            if signed_in?
              menu = [
                link_to(_("Frontpage"), root_path)
              ]
              
              
              menu << link_to(_("Customers"), customers_path) if can?(:manage, Customer)
              menu << link_to(_("Projects"), projects_path) if can?(:manage, Project)
              
              menu << link_to(_("Tasks"), tasks_path)
              menu << link_to(_("Users"), users_path)
              
              if can?(:admin, :admin)
                menu << link_to(_("Timelogs"), timelogs_path)
                menu << link_to(_("Work-status"), workstatus_index_path)
                menu << link_to(_("Administration"), "?show=admin")
              end
              
              menu << link_to(_("Your profile"), profile_index_path)
              menu << link_to(_("Log out"), logout_user_authentications_path, :method => :delete)
            else
              menu = [
                link_to(_("Log in"), "?show=user_login")
              ]
            end
            
            menu.each do |mi|
              %>
                <%=mi%>&nbsp;&nbsp;&nbsp;
              <%
            end
          %>
          </div>
        </div>
        <div class="main_content">
          <h1><%= yield(:header_title) %></h1>
          
          <% flash.each do |type, message| %>
            <div class="flash flash-<%= type %>">
              <%= message %>
            </div>
          <% end %>
          
          <%= yield %>
        </div>
      </td>
      <td class="main_side_right"></td>
    </tr>
    <tr>
      <td class="main_side_left"></td>
      <td class="main_bottom">
        <div style="padding-bottom: 15px;">
          Language:
          <select style="width: 100px;" onchange="locales_set(this.value);">
            <%= Knj::Web.opts(available_locales, I18n.locale.to_s).html_safe %>
          </select>
        </div>
        
        <%= sprintf(_("Made by %s"), "<a href=\"mailto:k@spernj.org\">Kasper Johansen</a>").html_safe %>
      </td>
      <td class="main_side_right"></td>
    </tr>
  </table>
  </center>
</body>
</html>